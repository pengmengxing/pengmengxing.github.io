# P13 反射

# 1.什么是反射，反射的作用是什么？

反射就是可以获取到类的Class文件，对字段（成员变量）、成员方法和构造函数进行编程访问。

像Android Studio或者IDEA这些IDE，当我们写一个对象通过一个.就会弹出它能访问的一些方法或者成员变量，这就是通过反射来实现的（获取到类的class，就能访问所有内容）。

![image-20240526163705372](C:\Users\Administrator\Desktop\黑马程序员基础课程\图片\image-20240526163705372.png)

反射的作用：

- 获取任意一个类的所有信息
- 结合配置文件动态创建对象



# 2.什么是Class文件？

Class对象就是字节码对象，使在预编译阶段，将java文件生成的class文件，是唯一的。因为字节码是唯一的，因此在加同步代码块（同步锁）时候通常会使用。





# 3.反射获取到Class文件的三种方式（字节码对象）

1.Class.forName("全类名")    //最为常用
2.类名.class        //一般用于作为参数传递，例如同步锁
3.对象.getClass()   //适用范围：对象已经创建

![image-20240526163214652](C:\Users\Administrator\Desktop\黑马程序员基础课程\图片\image-20240526163214652.png)

```java
//获得class的三种方式
//1.Class.forName("全类名")    适用范围：预编译阶段之后
//2.类名.class        适用范围：加载阶段
//3.对象.getClass()   适用范围：对象已经创建，是在运行阶段

//方式1：全类名 = 包名 + 类名  全类名的复制方式：找到相关类中类名->右键->copy->copy reference
Class clazz1 = Class.forName("com.learn.heima.Student");
System.out.println(clazz1); //输出结果class com.learn.heima.Student

//方式2：类名.class
Class clazz2 = Student.class;
System.out.println(clazz2); //输出结果class com.learn.heima.Student

//方式3：已经实例化类的对象，对象.getClass()
Student stu1 = new Student();
Class clazz3 = stu1.getClass();
System.out.println(clazz3); //输出结果class com.learn.heima.Student


System.out.println("clazz1和clazz2的比较值 = " + (clazz1 == clazz2));    //true，说明了字节码的唯一性
System.out.println("clazz2和clazz3的比较值 = " + (clazz2 == clazz3));    //true
```



# 4.反射获取到构造方法？

![image-20240526163737197](C:\Users\Administrator\Desktop\黑马程序员基础课程\图片\image-20240526163737197.png)

```
//获得构造函数的方法
//获取Student的所有公共构造函数
for (int i = 0;i < clazz1.getConstructors().length;i++) {
    //public com.learn.heima.Student(java.lang.String,int,java.lang.String,java.lang.String)
    //public com.learn.heima.Student()
    System.out.println(clazz1.getConstructors()[i]);
}

//获取Student的所有构造函数(包括私有、保护和公有)
for (int i = 0;i < clazz1.getDeclaredConstructors().length;i++) {
    //public com.learn.heima.Student(java.lang.String,int,java.lang.String,java.lang.String)
    //private com.learn.heima.Student(java.lang.String,int,java.lang.String)
    //public com.learn.heima.Student()
    System.out.println(clazz1.getDeclaredConstructors()[i]);
}

//根据参数类型获取到私有的构造函数
Constructor constructor = clazz1.getDeclaredConstructor(String.class, int.class, String.class);
//获取的构造函数的名字
System.out.println(constructor.getName());  //打印：com.learn.heima.Student

//临时取消权限校验（暴力反射）
constructor.setAccessible(true);
//使用私有构造方法创建对象   注意上面的getDeclaredConstructor只是可以看到，并不是可以访问，
// 强制访问私有成员方法需要setAccessible暴力访问
Student stu2 = (Student)constructor.newInstance("小明", 13, "19940714");
stu2.eat("香蕉"); //小明在吃香蕉
```





# 5.反射获取到成员变量？

![image-20240526211214426](C:\Users\Administrator\Desktop\黑马程序员基础课程\图片\image-20240526211214426.png)

```
 //获取所有公有字段（成员变量）
 for (int i = 0; i < clazz1.getFields().length; i++) {
     //public java.lang.String com.learn.heima.Student.name
     //public java.lang.String com.learn.heima.Student.number
     System.out.println(clazz1.getFields()[i]);
 }

//获取所有的成员变量
for (int i = 0; i < clazz1.getDeclaredFields().length; i++) {
    //public java.lang.String com.learn.heima.Student.name
    //private int com.learn.heima.Student.age
    //protected java.lang.String com.learn.heima.Student.gender
    //public java.lang.String com.learn.heima.Student.number
    System.out.println(clazz1.getDeclaredFields()[i]);
}


Field field1 = clazz1.getField("name");
System.out.println(stu2);   //Student{name='小明', age=13, gender='19940714', number='null'}
//修改stu2对象的name
field1.set(stu2,"xiaozhou");    //Student{name='xiaozhou', age=13, gender='19940714', number='null'}
System.out.println(stu2);
//获取stu2中该成员变量的值
System.out.println(field1.get(stu2));
//访问公用的成员变量
System.out.println(clazz1.getField("name"));    //打印public java.lang.String com.learn.heima.Student.name
//访问某一个的成员变量
System.out.println(clazz1.getDeclaredField("gender"));

System.out.println("#############");
```







# 6.反射获取到成员方法？



![image-20240526212756092](C:\Users\Administrator\Desktop\黑马程序员基础课程\图片\image-20240526212756092.png)

```
//获取所有的公有方法（包含父类在内的公有方法）
for (int i = 0; i < clazz1.getMethods().length; i++) {
	System.out.println(clazz1.getMethods()[i]);
}

//获取父类的所有方法，不包括父类的公共方法，但是包括本类的私有方法
for (int i = 0; i < clazz1.getDeclaredMethods().length; i++) {
	System.out.println(clazz1.getDeclaredMethods()[i]);
}


//获取某一个方法，例如eat方法,第一个参数是方法名，第二个是参数类型，避免重载
Student stu3 = new Student("小周",13,"男","19940714");
Method method = clazz1.getMethod("eat", String.class); 
System.out.println(method.invoke(stu3,"香蕉")); //小周在吃香蕉 返回值 null

```

# 7.练习：保存对象所有字段名和值，保存到文件中

```
package com.learn.heima;

import java.io.*;
import java.lang.reflect.Field;

public class Main {
    public static void main(String[] args) throws IllegalAccessException, IOException {
        Student student = new Student("小孙",12,"男");
        Teacher teacher = new Teacher("李老师",10000);

        saveObject(student);

    }

    private static void saveObject(Object obj) throws IllegalAccessException, IOException {
        //1.获取到字节码文件
        Class clazz = obj.getClass();


        //2.创建IO流
        //现在目录下创建一个文件
        BufferedWriter bufferedWriter = new BufferedWriter(new FileWriter("src\\info.txt"));


        //获取对象中的所有成员变量
        Field[] declaredFields = clazz.getDeclaredFields();
        for (Field field : declaredFields) {
            //获取成员变量名字
            String name = field.getName();
            //获取成员变量值
            Object value = field.get(obj);
            //写入文件
            bufferedWriter.write(name + " = " + value);
            //换行
            bufferedWriter.newLine();
        }
        //关闭写入
        bufferedWriter.close();
    }
}
```









# 100.反射学习完整代码

